{% comment %} components/input_area.html {% endcomment %}

<div class="bg-white border-t p-4 shadow-md">
    <div class="max-w-4xl mx-auto">
        <div x-data="{ isOpen: false, openedWithKeyboard: false }" class="relative w-fit p-2" x-on:keydown.esc.window="isOpen = false, openedWithKeyboard = false">
            <!-- Toggle Button -->
            <button type="button" 
                x-on:click="disableModelSelect ? null : isOpen = !isOpen" 
                :disabled="disableModelSelect"
                :class="disableModelSelect ? 'opacity-50 cursor-not-allowed' : ''"
                class="inline-flex items-center gap-2 whitespace-nowrap rounded-radius border border-outline px-4 py-2 text-sm font-medium tracking-wide transition hover:opacity-75 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-outline-strong dark:border-outline-dark dark:bg-surface-dark-alt dark:focus-visible:outline-outline-dark-strong" 
                aria-haspopup="true" 
                x-on:keydown.space.prevent="disableModelSelect ? null : openedWithKeyboard = true" 
                x-on:keydown.enter.prevent="disableModelSelect ? null : openedWithKeyboard = true" 
                x-on:keydown.down.prevent="disableModelSelect ? null : openedWithKeyboard = true" 
                x-bind:class="isOpen || openedWithKeyboard ? 'text-on-surface-strong dark:text-on-surface-dark-strong' : 'text-on-surface dark:text-on-surface-dark'" 
                x-bind:aria-expanded="isOpen || openedWithKeyboard">
                <span x-text="selectedModel || 'gemma3:1b'"></span>
                <svg aria-hidden="true" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-4 rotate-180">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
                </svg>        
            </button>
            
            <!-- Dropdown Menu - Hanya tampilkan jika tidak disable -->
            <div x-cloak 
                x-show="!disableModelSelect && (isOpen || openedWithKeyboard)" 
                x-transition 
                x-trap="openedWithKeyboard" 
                x-on:click.outside="isOpen = false, openedWithKeyboard = false" 
                x-on:keydown.down.prevent="$focus.wrap().next()" 
                x-on:keydown.up.prevent="$focus.wrap().previous()" 
                class="absolute bottom-11 flex w-fit min-w-48 flex-col overflow-hidden rounded-radius border border-outline bg-gray-300 dark:border-outline-dark dark:bg-surface-dark-alt" 
                role="menu">
                <button x-on:click="selectModel('gemma3:1b'); isOpen = false" class="bg-surface-alt px-4 py-2 text-sm text-on-surface hover:bg-surface-dark-alt/5 hover:text-on-surface-strong focus-visible:bg-surface-dark-alt/10 focus-visible:text-on-surface-strong focus-visible:outline-hidden dark:bg-surface-dark-alt dark:text-on-surface-dark dark:hover:bg-surface-alt/5 dark:hover:text-on-surface-dark-strong dark:focus-visible:bg-surface-alt/10 dark:focus-visible:text-on-surface-dark-strong" role="menuitem">Gemma 3 1B</button>
                <button x-on:click="selectModel('qwen2.5-coder:0.5b'); isOpen = false" class="bg-surface-alt px-4 py-2 text-sm text-on-surface hover:bg-surface-dark-alt/5 hover:text-on-surface-strong focus-visible:bg-surface-dark-alt/10 focus-visible:text-on-surface-strong focus-visible:outline-hidden dark:bg-surface-dark-alt dark:text-on-surface-dark dark:hover:bg-surface-alt/5 dark:hover:text-on-surface-dark-strong dark:focus-visible:bg-surface-alt/10 dark:focus-visible:text-on-surface-dark-strong" role="menuitem">Qwen2.5-coder 0.5B</button>
                <button x-on:click="selectModel('deepseek-r1:1.5b'); isOpen = false" class="bg-surface-alt px-4 py-2 text-sm text-on-surface hover:bg-surface-dark-alt/5 hover:text-on-surface-strong focus-visible:bg-surface-dark-alt/10 focus-visible:text-on-surface-strong focus-visible:outline-hidden dark:bg-surface-dark-alt dark:text-on-surface-dark dark:hover:bg-surface-alt/5 dark:hover:text-on-surface-dark-strong dark:focus-visible:bg-surface-alt/10 dark:focus-visible:text-on-surface-dark-strong" role="menuitem">Deepseek-r1 1.5B</button>
            </div>
        </div>
        <div
            class="message-input-container flex items-end space-x-2 bg-white border border-gray-300 px-3 py-2 rounded-xl focus-within:border-indigo-400">
            <textarea x-ref="messageInput" x-model="messageText" @input="autoResizeTextarea"
                @keydown.enter.prevent="handleEnterKey" placeholder="Type your message here..."
                class="auto-resize-textarea flex-1 border-0 py-1 px-0 focus:outline-none focus:ring-0 min-h-[42px]"></textarea>

            <button @click="sendMessage" :disabled="!messageText.trim()"
                :class="messageText.trim() ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-gray-300 cursor-not-allowed'"
                class="text-white p-2 rounded-lg transition duration-200 flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                </svg>
            </button>
        </div>
        <div class="text-xs text-gray-500 mt-1.5 pl-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Press Enter to send, Shift+Enter for new line
        </div>
    </div>
</div>